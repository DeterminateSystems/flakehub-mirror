{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import * as actionsCore from \"@actions/core\";\n\nfunction makeMinorVersion(ref: string): string {\n  const regex = new RegExp(\n    /^nixos-(?<version>([0-9]+\\.[0-9]+)(-small)?|unstable)$/,\n  );\n  const match = regex.exec(ref);\n  if (match && match.groups) {\n    const versionPart = match.groups.version;\n    if (versionPart) {\n      const minorVersion =\n        versionPart === \"unstable\" ? \"1\" : versionPart.replace(\".\", \"\");\n      return minorVersion;\n    } else {\n      throw new Error(`version part is undefined in matches: ${match.groups}`);\n    }\n  } else {\n    throw new Error(`Branch didn't match our publishable regex.`);\n  }\n}\n\nfunction main(): void {\n  const context = process.env;\n  const ref = process.env[\"RELEASE_BRANCH\"];\n  if (ref === undefined) {\n    actionsCore.setFailed(`ref is undefined in context: ${context}`);\n  } else {\n    actionsCore.info(`Calculating the minor version for ${ref}`);\n\n    try {\n      const minorVersion = makeMinorVersion(ref);\n      actionsCore.info(`Minor version part: ${minorVersion}`);\n      actionsCore.setOutput(\"minorVersion\", minorVersion);\n    } catch (e: unknown) {\n      if (typeof e === \"string\") {\n        actionsCore.setFailed(e);\n      } else if (e instanceof Error) {\n        actionsCore.setFailed(e.message);\n      } else {\n        actionsCore.setFailed(\"Unknown type caught in catch block\");\n      }\n    }\n  }\n}\n\nmain();\n"],"mappings":";AAAA,YAAY,iBAAiB;AAE7B,SAAS,iBAAiB,KAAqB;AAC7C,QAAM,QAAQ,IAAI;AAAA,IAChB;AAAA,EACF;AACA,QAAM,QAAQ,MAAM,KAAK,GAAG;AAC5B,MAAI,SAAS,MAAM,QAAQ;AACzB,UAAM,cAAc,MAAM,OAAO;AACjC,QAAI,aAAa;AACf,YAAM,eACJ,gBAAgB,aAAa,MAAM,YAAY,QAAQ,KAAK,EAAE;AAChE,aAAO;AAAA,IACT,OAAO;AACL,YAAM,IAAI,MAAM,yCAAyC,MAAM,MAAM,EAAE;AAAA,IACzE;AAAA,EACF,OAAO;AACL,UAAM,IAAI,MAAM,4CAA4C;AAAA,EAC9D;AACF;AAEA,SAAS,OAAa;AACpB,QAAM,UAAU,QAAQ;AACxB,QAAM,MAAM,QAAQ,IAAI,gBAAgB;AACxC,MAAI,QAAQ,QAAW;AACrB,IAAY,sBAAU,gCAAgC,OAAO,EAAE;AAAA,EACjE,OAAO;AACL,IAAY,iBAAK,qCAAqC,GAAG,EAAE;AAE3D,QAAI;AACF,YAAM,eAAe,iBAAiB,GAAG;AACzC,MAAY,iBAAK,uBAAuB,YAAY,EAAE;AACtD,MAAY,sBAAU,gBAAgB,YAAY;AAAA,IACpD,SAAS,GAAY;AACnB,UAAI,OAAO,MAAM,UAAU;AACzB,QAAY,sBAAU,CAAC;AAAA,MACzB,WAAW,aAAa,OAAO;AAC7B,QAAY,sBAAU,EAAE,OAAO;AAAA,MACjC,OAAO;AACL,QAAY,sBAAU,oCAAoC;AAAA,MAC5D;AAAA,IACF;AAAA,EACF;AACF;AAEA,KAAK;","names":[]}